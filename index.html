<!DOCTYPE html>
<html>
  <head>
    <title>Juego AR Esferas</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.0.7/aframe/build/aframe-ar.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <!-- C√°mara -->
      <a-entity camera id="playerCam"></a-entity>

      <!-- Esfera (se generar√° por c√≥digo) -->
      <a-entity id="gameManager"></a-entity>
    </a-scene>

    <script>
      let esferasTomadas = 0;
      let esferaActual = null;
      const distanciaSpawn = 5;
      const distanciaRecoleccion = 0.5;

      function generarEsfera() {
        if (esferaActual) esferaActual.parentNode.removeChild(esferaActual);

        // Crear la esfera
        esferaActual = document.createElement("a-sphere");
        esferaActual.setAttribute("radius", "0.25");
        esferaActual.setAttribute("color", "red");

        // Posici√≥n: a 5m delante del jugador
        const cam = document.querySelector("#playerCam");
        const camPos = cam.object3D.position;
        const camDir = new THREE.Vector3();
        cam.object3D.getWorldDirection(camDir);

        let spawnPos = new THREE.Vector3().copy(camPos).add(camDir.multiplyScalar(distanciaSpawn));
        esferaActual.object3D.position.set(spawnPos.x, spawnPos.y, spawnPos.z);

        document.querySelector("a-scene").appendChild(esferaActual);
      }

      function tomarEsfera() {
        esferasTomadas++;
        esferaActual.parentNode.removeChild(esferaActual);
        esferaActual = null;

        if (esferasTomadas < 5) {
          generarEsfera();
        } else {
          alert("üéâ ¬°Ganaste! Has recolectado 5 esferas.");
        }
      }

      // Comprobar proximidad en cada frame
      setInterval(() => {
        if (!esferaActual) return;

        const cam = document.querySelector("#playerCam");
        const camPos = cam.object3D.position;
        const esferaPos = esferaActual.object3D.position;

        const dist = camPos.distanceTo(esferaPos);
        if (dist <= distanciaRecoleccion) {
          tomarEsfera();
        }
      }, 200);

      // Generar la primera esfera al inicio
      window.onload = () => {
        generarEsfera();
      };
    </script>
  </body>
</html>